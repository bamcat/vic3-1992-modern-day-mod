namespace = un_events

# Assigns UNSC

un_events.99 = {
    type = country_event
    placement = ROOT
    title = "" # hidden, no localization needed
    desc = ""  # hidden, no localization needed
	event_image = { video = "africa_diplomats_negotiating" }
    hidden = yes
	duration = 1
	trigger = {	
		NOT = { c:USA = { has_modifier = permanent_unsc_member } }
	}
		
    immediate = {
		set_global_variable = { name = un_peacekeeping_votes value = 0 }
		set_global_variable = { name = un_peacekeeping_num_votes value = 0 }
        every_country = {
			limit = {
				c:USA ?= this
			}
			save_scope_as = country_ranking_1
			add_modifier = {
				name = permanent_unsc_member
				days = -1
			}
		}
		set_global_variable = {
			name = permanent_members_1
			value = scope:country_ranking_1
		}
		every_country = {
			limit = {
				c:FRA ?= this
			}
			save_scope_as = country_ranking_2
			add_modifier = {
				name = permanent_unsc_member
				days = -1
			}
		}
		set_global_variable = {
			name = permanent_members_2
			value = scope:country_ranking_2
		}
		every_country = {
			limit = {
				c:GBR ?= this
			}
			add_modifier = {
				name = permanent_unsc_member
				days = -1
			}
			save_scope_as = country_ranking_3
		}
		set_global_variable = {
			name = permanent_members_3
			value = scope:country_ranking_3
		}
		every_country = {
			limit = {
				c:PRC ?= this
			}
			add_modifier = {
				name = permanent_unsc_member
				days = -1
			}
			save_scope_as = country_ranking_4
		}
		set_global_variable = {
			name = permanent_members_4
			value = scope:country_ranking_4
		}
		
		every_country = {
			limit = {
				c:RUS ?= this
			}
			add_modifier = {
				name = permanent_unsc_member
				days = -1
			}
			save_scope_as = country_ranking_5
		}
		set_global_variable = {
			name = permanent_members_5
			value = scope:country_ranking_5
		}
    }
}

# Motion selection UI (only the proposer sees the popup)
un_events.100 = {
    type = country_event
    placement = ROOT
    title = un_events.100.t
    desc = un_events.100.d
    event_image = { video = "parliament" }

    # Player chooses the motion to propose
    option = {
        name = un_events.100.a
            set_global_variable = { name = un_motion_active value = yes }
            set_global_variable = { name = un_current_motion_name value = "Resolution on Environmental Protection" }
            every_country = { trigger_event = { id = un_events.101 days = 29 } }
            # schedule the result processor to run in 7 days (single global processing)
            trigger_event = { id = un_events.201 days = 120 }

    }
    option = {
        name = un_events.100.b
            set_global_variable = { name = un_motion_active value = yes }
            set_global_variable = { name = un_current_motion_name value = "Resolution on World Peace" }
            every_country = { trigger_event = { id = un_events.101 days = 29 } }
            trigger_event = { id = un_events.201 days = 120 }

    }
    option = {
        name = un_events.100.c
            set_global_variable = { name = un_motion_active value = yes }
            set_global_variable = { name = un_current_motion_name value = "Resolution on Economic Development" }
            every_country = { trigger_event = { id = un_events.101 days = 29 } }
            trigger_event = { id = un_events.201 days = 120 }
        
    }
    option = {
        name = un_events.100.e
            set_global_variable = { name = un_motion_active value = yes }
            set_global_variable = { name = un_current_motion_name value = "Resolution on UNESCO Technology" }
            every_country = { trigger_event = { id = un_events.101 days = 29 } }
            trigger_event = { id = un_events.201 days = 120 }
        
    }
}

# 2) Voting event (fires for every country; uses global vars to tally)
un_events.101 = {
    type = country_event
    placement = ROOT
    title = un_events.101.t
    desc = un_events.101.d
    event_image = { video = "parliament" }

    option = {
        name = un_events.101.a
            # Permanent members get double-weight yes (if they are a perm member)
            if = {
                limit = {
                    OR = {
                        c:USA ?= this
                        c:FRA ?= this
						c:GBR ?= this
						c:RUS ?= this
						c:PRC ?= this
                    }
                }
                change_global_variable = { name = un_motion_yes_votes add = 2 }
            }
            else = {
                change_global_variable = { name = un_motion_yes_votes add = 1 }
            }
    }

    option = {
        name = un_events.101.b
            # A NO from a permanent member creates a veto: store the country scope in a global
            #if = {
            #    limit = {
            #       OR = {
            #           c:USA ?= this
            #           c:FRA ?= this
			#			c:GBR ?= this
			#			c:RUS ?= this
			#			c:PRC ?= this
            #        }
            #    }
            #    set_global_variable = { name = un_motion_veto value = this }
            #}
            change_global_variable = { name = un_motion_no_votes add = 1 }
    }
}

# 3) Hidden processing event (fires once, scheduled when motion was proposed)
un_events.201 = {
    type = country_event
    hidden = yes
    placement = ROOT

    immediate = {
        # If a veto exists — notify everyone via un_events.202_veto
        #if = {
        #    limit = { has_global_variable = un_motion_veto }
		#     every_country = { country_event = { id = un_events.202_veto popup = yes } }
        #}
        # Else if yes_votes > no_votes => pass
        if = {
            limit = { global_var:un_motion_yes_votes >= global_var:un_motion_no_votes }
            every_country = { post_notification = un_passed }
        }
        else = {
            every_country = { post_notification = un_fail }
        }

        # Cleanup global motion variables (removes lock so a new motion may occur)
        remove_global_variable = un_motion_active
        set_global_variable = { un_motion_yes_votes value = 0 }
        set_global_variable = { un_motion_no_votes value = 0 }
        remove_global_variable = un_current_motion_name
        remove_global_variable = un_motion_veto
    }
}


# Request Peacekeepers
un_events.1 = {
	type = country_event
	title = un_events.1.t
	desc = un_events.1.d
	icon = "gfx/interface/icons/event_icons/event_united_nations.dds"
	event_image = { video = "africa_diplomats_negotiating" }
	immediate = { }
	
	option = {
		name = un_events.1.a
		set_global_variable = {
					name = peacekeeper_requestor
					value = ROOT
					}
		if = { limit = { has_variable = already_got_peacekeep }
			remove_variable = already_got_peacekeep
		}
		every_country = {
			limit = { has_modifier = permanent_unsc_member }
			trigger_event = { id = un_events.2 }
		}
		every_country = {
		limit = { has_variable = already_got_participation_trophy }
		remove_variable = already_got_participation_trophy
		}
	}
}
# Peacekeeper Vote
un_events.2 = {
	type = country_event
	title = un_events.2.t
	desc = un_events.2.d
	icon = "gfx/interface/icons/event_icons/event_united_nations.dds"
	event_image = { video = "africa_diplomats_negotiating" }
	duration = 1
	
	option = {
		name = un_events.2.a
		is_default_option = yes
		custom_tooltip = you_vote_yes
		change_global_variable = { name = un_peacekeeping_votes add = 1 }
		change_global_variable = { name = un_peacekeeping_num_votes add = 1 }
		hidden_effect = { 
			global_var:peacekeeper_requestor = {
				trigger_event = { id = un_events.3 days = 35 } 
				trigger_event = { id = un_events.4 days = 35 }
				}
		}
	}
	
	option = {
		name = un_events.2.b
		custom_tooltip = you_abstain
		change_global_variable = { name = un_peacekeeping_num_votes add = 1 }
		hidden_effect = { 
			global_var:peacekeeper_requestor = {
				trigger_event = { id = un_events.3 days = 35 } 
				trigger_event = { id = un_events.4 days = 35 }
				}
		}
	}
	
	option = {
		name = un_events.2.c
		custom_tooltip = you_vote_no
		change_global_variable = { name = un_peacekeeping_votes subtract = -1 }
		change_global_variable = { name = un_peacekeeping_num_votes add = 1 }
		hidden_effect = { 
			global_var:peacekeeper_requestor = {
				trigger_event = { id = un_events.3 days = 35 } 
				trigger_event = { id = un_events.4 days = 35 }
				}
		}
	}
	
	option = {
		name = un_events.2.e
		custom_tooltip = you_veto
		change_global_variable = { name = un_peacekeeping_votes subtract = -5 }
		change_global_variable = { name = un_peacekeeping_num_votes add = 1 }
		hidden_effect = { 
			global_var:peacekeeper_requestor = {
				trigger_event = { id = un_events.3 days = 35 } 
				trigger_event = { id = un_events.4 days = 35 }
				}
		}
	}
}


# Peacekeepers are on their way
un_events.3 = {
	type = country_event
	title = un_events.3.t
	desc = un_events.3.d
	icon = "gfx/interface/icons/event_icons/event_united_nations.dds"
	event_image = { video = "africa_diplomats_negotiating" }
	
	trigger = { 
		global_var:un_peacekeeping_votes >= 2.5
		global_var:un_peacekeeping_num_votes >= 5
		NOT = { has_variable = already_got_peacekeep }
	}
	
	
	immediate = { add_modifier = {
			name = un_peacekeepers_deployed
			days = 730
		}
		set_global_variable = { name = un_peacekeeping_votes value = 0 }
		set_variable = already_got_peacekeep
		every_country = {
			trigger_event = { id = un_events.5 }
			}
		set_global_variable = { name = un_peacekeeping_votes value = 0 }
		set_global_variable = { name = un_peacekeeping_num_votes value = 0 }
		}
		
	option = {
		name = un_events.3.a
	}
}

# Peacekeeping Veto'd
un_events.4 = {
	type = country_event
	title = un_events.4.t
	desc = un_events.4.d
	icon = "gfx/interface/icons/event_icons/event_united_nations.dds"
	event_image = { video = "africa_diplomats_negotiating" }
	
	trigger = {
		global_var:un_peacekeeping_votes <= 2.5
		global_var:un_peacekeeping_num_votes >= 5
		has_variable = already_got_peacekeep
	}
	
	immediate = {
		set_global_variable = { name = un_peacekeeping_votes value = 0 }
		set_global_variable = { name = un_peacekeeping_num_votes value = 0 }
		set_variable = already_got_peacekeep
	}
	
	option = {
		name = un_events.4.a
		remove_modifier = un_peacekeepers_deployed
		 add_modifier = {
			name = un_peacekeepers_vetoed
			days = 730
		}
	}
}

# participation trophy
un_events.5 = {
	type = country_event
	title = un_events.5.t
	desc = un_events.5.d
	icon = "gfx/interface/icons/event_icons/event_united_nations.dds"
	event_image = { video = "europenorthamerica_before_the_battle" }
	duration = 1
	trigger = { NOT = { has_variable = already_got_participation_trophy } NOT = { has_war_with = scope:peacekeeper_requestor } NOT = { scope:peacekeeper_requestor ?= this }  }
	immediate = { set_variable = already_got_participation_trophy }
		
	option = {
		name = un_events.5.a
		change_relations = {
				country = global_var:peacekeeper_requestor
				value = 10
				}
	}
	option = {
		name = un_events.5.b
		change_relations = {
				country = global_var:peacekeeper_requestor
				value = -10
				}
	}
}